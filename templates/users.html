{% extends 'base.html' %}
{% block content %}
<h2>Users</h2>
<table class="table">
  <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Action</th></tr></thead>
  <tbody>
    {% for u in users %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ u.name }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.role }}</td>
        <td>
          <form method="post" action="/admin/user/{{ u.id }}/promote" class="d-inline">
            <select name="role" class="form-select form-select-sm d-inline w-auto">
              <option value="member" {% if u.role=='member' %}selected{% endif %}>Member</option>
              <option value="admin" {% if u.role=='admin' %}selected{% endif %}>Admin</option>
            </select>
            <button class="btn btn-sm btn-primary">Update</button>
          </form>
          <div class="btn-group ms-2">
            <form method="post" action="/admin/user/{{ u.id }}/send_reset" class="d-inline">
              <button class="btn btn-sm btn-warning" onclick="return confirm('Send password reset email to {{ u.email }}?')">ğŸ”‘ Send reset</button>
            </form>
            <form method="post" action="/admin/user/{{ u.id }}/set_temp_password" class="d-inline">
              <button class="btn btn-sm btn-danger" onclick="return confirm('Set a temporary password and email it to {{ u.email }}?')">âœ‰ï¸ Set temp</button>
            </form>
            {% if u.role != 'admin' %}
            <form method="post" action="/admin/user/{{ u.id }}/delete" class="d-inline ms-2">
              <button class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete user {{ u.email }}? This will remove their transactions and payments.')">ğŸ—‘ï¸ Delete</button>
            </form>
            {% endif %}
          </div>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}