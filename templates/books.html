{% extends 'base.html' %}
{% block content %}
<h2>Books</h2>
<div class="list-group">
  {% for b in books %}
    <div class="list-group-item d-flex">
      <div class="me-3" style="width:80px;">
          <img src="/{{ b['image'] or 'static/book_images/default.png' }}" alt="cover" class="img-thumbnail" style="max-width:80px; max-height:80px;">
      </div>
      <div class="flex-grow-1">
        <strong><a href="/book/{{ b['id'] }}">{{ b['title'] }}</a></strong> by {{ b['author'] }} <br>
        <small>ISBN: {{ b['isbn'] }} | Category: {{ b['category'] or 'â€”' }}</small><br>
        {% if b['pdf'] %}
          <a href="/{{ b['pdf'] }}" class="me-2" target="_blank">Download PDF</a>
        {% endif %}
      </div>
      <div class="text-end">
        <div class="mb-2">Available: {{ b['available'] }}</div>
        {% if b['available'] > 0 %}
          <a class="btn btn-sm btn-success" href="/borrow/{{ b['id'] }}">Borrow</a>
        {% else %}
          <button class="btn btn-sm btn-secondary" disabled>Not available</button>
        {% endif %}
        {% if session.user_role == 'admin' %}
          <div class="mt-2">
            <a class="btn btn-sm btn-outline-primary" href="/admin/book/{{ b['id'] }}/edit">Edit</a>
            <form method="post" action="/admin/book/{{ b['id'] }}/delete" class="d-inline ms-2">
              <button class="btn btn-sm btn-danger" onclick="return confirm('Delete book {{ b.title }}?')">Delete</button>
            </form>
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}